@page "/login"
@using Web.Models;
@using Dybi.App.Services;

@inject NavigationManager NavigationManager;
@inject IAuthService AuthService;

<div class="row">
    <div class="col-md-4 mx-auto">
        <div class="panel-body py-5">
                <EditForm Model="LoginModel" OnValidSubmit="HandleLogin">
                <DataAnnotationsValidator></DataAnnotationsValidator>
                    @if (ShowErrors)
                    {
                        <div class="alert alert-danger">
                            <p>@Error</p>
                        </div>
                    }

                <div class="form-floating mb-3">
                    <InputText id="username" class="form-control" placeholder="Tên đăng nhập" @bind-Value="LoginModel.UserName"></InputText>
                    <label for="username">Tên đăng nhập</label>
                    <ValidationMessage For="()=> LoginModel.UserName"></ValidationMessage>
                </div>
                <div class="form-floating mb-3">
                    <InputText id="password" type="password" class="form-control" placeholder="Mật khẩu" @bind-Value="LoginModel.Password"></InputText>
                    <label for="password">Mật khẩu</label>
                    <ValidationMessage For="()=> LoginModel.Password"></ValidationMessage>
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col-lg-7">
                            <div class="custom-control custom-checkbox">
                                <InputCheckbox class="form-check-input" type="checkbox" @bind-Value="LoginModel.IsPeristant" id="isPeristant" /> Giữ chế độ đăng nhập
                            </div>
                        </div>
                        <div class="col-lg-5" style="text-align:right">
                            <a href="/Login/ForgetPassword">Quân mật khẩu</a>
                        </div>
                    </div>
                </div>

                <div class="d-grid gap-2 py-3">
                    <input type="submit" class="btn btn-success btn-lg" value="Đăng nhập">
                </div>

                @* <div class="text-center text-lg-start">
                    <p class="small fw-bold mt-2 pt-1 mb-0">
                        Chưa có tài khoản? <a href="/signup"
                                              class="link-danger">Đăng ký</a>
                    </p>
                </div> *@
            </EditForm>
        </div>
    </div>
</div>

@code {
    private bool ShowErrors;
    private string Error = "";
    private LoginRequest LoginModel = new LoginRequest();

    private async Task HandleLogin()
    {
        ShowErrors = false;

        var result = await AuthService.Login(LoginModel);
        if (result.Successful)
        {
            //NavigationManager.NavigateTo("home");
            NavigationManager.NavigateTo("/", true);
        }
        else
        {
            ShowErrors = true;
            Error = result.Error;
        }
    }
}