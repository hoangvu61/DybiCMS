@page "/login"
@using Web.Models;
@using Web.Admin.Services;

@inject NavigationManager NavigationManager;
@inject IAuthService AuthService;

<style>
    .panel-body {
        padding: 15px
    }

    .panel-default {
        border: 1px solid #ddd;
        margin-top: 100px;
        margin-bottom: 200px
    }

    .form-group {
        margin-bottom: 15px
    }

    .btn-block {
        width: 100%
    }
</style>
<div class="row">
<div class="col-md-4 offset-md-4">
    <div class="login-panel panel panel-default">
        <div class="panel-body">
             <EditForm Model="LoginModel" OnValidSubmit="HandleLogin">
                <DataAnnotationsValidator></DataAnnotationsValidator>
                    @if (ShowErrors)
                    {
                        <div class="alert alert-danger">
                            <p>@Error</p>
                        </div>
                    }
                <div class="form-group">
                    <InputText id="username" class="form-control text-box single-line" placeholder="Tên đăng nhập" @bind-Value="LoginModel.UserName"></InputText>
                    <ValidationMessage For="()=> LoginModel.UserName"></ValidationMessage>
                </div>
                <div class="form-group">
                    <InputText id="password" type="password" class="form-control text-box single-line" placeholder="Mật khẩu" @bind-Value="LoginModel.Password"></InputText>
                    <ValidationMessage For="()=> LoginModel.Password"></ValidationMessage>
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col-lg-7">
                                <div class="custom-control custom-checkbox">
                            <InputCheckbox class="form-check-input" type="checkbox" @bind-Value="LoginModel.IsPeristant" id="isPeristant" /> Giữ chế độ đăng nhập
                                </div>
                        </div>
                        <div class="col-lg-5" style="text-align:right">
                            <a href="/Login/ForgetPassword">Quân mật khẩu</a>
                        </div>
                    </div>
                </div>

                <!-- Change this to a button or input when using this as a form -->
                <input type="submit" class="btn btn-lg btn-success btn-block" value="Đăng nhập">

                <div class="text-center text-lg-start mt-4 pt-2">
                    <p class="small fw-bold mt-2 pt-1 mb-0">
                            Chưa có tài khoản? <a href="/signup"
                                                  class="link-danger">Đăng ký</a>
                    </p>
                </div>
            </EditForm>
        </div>
    </div>
</div>
</div>

@code {
    private bool ShowErrors;
    private string Error = "";
    private LoginRequest LoginModel = new LoginRequest();

    private async Task HandleLogin()
    {
        ShowErrors = false;

        var result = await AuthService.Login(LoginModel);
        if (result.Successful)
        {
            //NavigationManager.NavigateTo("home");
            NavigationManager.NavigateTo("/", true);
        }
        else
        {
            ShowErrors = true;
            Error = result.Error;
        }
    }
}