@using Microsoft.AspNetCore.Components.Authorization;
@using System.Security.Claims
@using Web.Admin.Services

@inject IAuthService AuthService;

<nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
            <a href="/" class="nav-link">Trang chủ</a>
        </li>
        <AuthorizeView Roles="Warehouse">
            <li class="nav-item d-none d-sm-inline-block">
                <a href="https://app.@Domain/login?token=@Token" class="nav-link" target="_blank">Quản lý Xuất/Nhập kho</a>
            </li>
        </AuthorizeView>
    </ul>

    <!-- Right navbar links -->
    <ul class="navbar-nav ml-auto">
        <!-- Notifications Dropdown Menu -->
        <li class="nav-item dropdown">
            <a class="nav-link" data-toggle="dropdown" href="#">
                 <AuthorizeView>
                    <Authorized>
                        @UserFullName
                    </Authorized>
                    <NotAuthorized>                        
                    </NotAuthorized>
                </AuthorizeView>
            </a>
            <div class="dropdown-menu dropdown-menu-right">
                <a href="/profile" class="dropdown-item">Thông tin cá nhân</a>
                <div class="dropdown-divider"></div>
                <a href="/logout" class="dropdown-item">Đăng xuất</a>
            </div>
        </li>
    </ul>
</nav>

@code {
    private string UserFullName { get; set; }
    private string Domain { get; set; }
    private string Token { get; set; }

    [CascadingParameter]
    private Task<AuthenticationState> authenticationStateTask { get; set; }
    protected override async Task OnInitializedAsync()
    {
        Token = await AuthService.GetToken();

        var authState = await authenticationStateTask;
        UserFullName = authState.User.FindFirst(ClaimTypes.GivenName)?.Value;
        Domain = authState.User.FindFirst(ClaimTypes.Webpage)?.Value;
    }
}