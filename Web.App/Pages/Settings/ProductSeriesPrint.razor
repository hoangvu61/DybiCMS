@page "/settings/product/{Id}/series"
@attribute [Authorize]
@layout NullLayout

@using Microsoft.AspNetCore.Authorization;
@using Web.App.Components
@using Web.App.Services;
@using Web.Models;
@using System.IO;
@using Web.Models.Enums
@inject IToastService ToastService;
@inject IWarehouseApiClient WarehouseApiClient;
@inject IJSRuntime JS

@if (Product != null)
{
    @foreach (var type in Series.Select(e => e.Type).Distinct().ToList())
    {
        <h1 class="text-center">@Product.Title - @Series.Count series - @Series.Count(e => e.Type == type) @type</h1>
        <div class="m-5">
            @foreach (var seri in Series.Where(e => e.Type == type).ToList())
            {
                <div style="border: 1px solid #000; padding:5px; float:left; position:relative">
                    <img src="@seri.ImageBase64" style="height:50px;" />
                    <div class="text-center">@seri.Seri</div>
                </div>
            }
        </div>
    }
}

@code {
    [Parameter]
    public string Id { set; get; }
    private List<ProductSeriDto> Series { set; get; } = new List<ProductSeriDto>();
    private ProductDetailDto Product { get; set; }

    protected async override Task OnInitializedAsync()
    {
        if (!string.IsNullOrEmpty(Id))
        {
            Product = await WarehouseApiClient.GetProductById(Id);
            Series = await WarehouseApiClient.ImageCodesByProduct(Id);
        }
    }
}